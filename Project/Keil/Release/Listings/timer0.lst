C51 COMPILER V9.60.7.0   TIMER0                                                            02/28/2026 15:34:24 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TIMER0
OBJECT MODULE PLACED IN .\Release\Objects\timer0.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\timer0.c LARGE OPTIMIZE(9,SIZE) BROWSE INTVECTOR(0X000C) INCD
                    -IR(..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\timer0.lst) OBJECT(.\Rele
                    -ase\Objects\timer0.obj)

line level    source

   1          #include "timer0.h"
   2          #include "user_config.h"
   3          #include "uart_data_handle.h"
   4          #include "adc.h"
   5          #include "ad_key.h"
   6          
   7          #include "led.h"
   8          
   9          #define PEROID_VAL (SYSCLK / 128 / 1000 - 1) // 周期值=系统时钟/分频/频率 - 1
  10          
  11          /**
  12           * @brief 配置定时器TMR0，定时器默认关闭
  13           */
  14          void timer0_init(void)
  15          {
  16   1          __EnableIRQ(TMR0_IRQn); // 使能timer0中断
  17   1          IE_EA = 1;              // 使能总中断
  18   1      
  19   1          TMR_ALLCON = TMR0_CNT_CLR(0x1);                        // 清除计数值
  20   1          TMR0_PRH = TMR_PERIOD_VAL_H((PEROID_VAL >> 8) & 0xFF); // 周期值
  21   1          TMR0_PRL = TMR_PERIOD_VAL_L((PEROID_VAL >> 0) & 0xFF);
  22   1          TMR0_CONH = TMR_PRD_PND(0x1) | TMR_PRD_IRQ_EN(0x1);                          // 计数等于周期时
             -许发生中断
  23   1          TMR0_CONL = TMR_SOURCE_SEL(0x7) | TMR_PRESCALE_SEL(0x7) | TMR_MODE_SEL(0x1); // 选择系统时钟，1
             -28分频，计数模式
  24   1      }
  25          
  26          // extern void fun(void);
  27          // 定时器TMR0中断服务函数
  28          void TIMR0_IRQHandler(void) interrupt TMR0_IRQn
  29          {
  30   1          // 进入中断设置IP，不可删除
  31   1          __IRQnIPnPush(TMR0_IRQn);
  32   1      
  33   1          // ---------------- 用户函数处理 -------------------
  34   1      
  35   1          // 周期中断
  36   1          if (TMR0_CONH & TMR_PRD_PND(0x1))
  37   1          {
  38   2              TMR0_CONH |= TMR_PRD_PND(0x1); // 清除pending
  39   2      
  40   2      #if USER_DEBUG_ENABLE
  41   2              timebase_update();
  42   2      #endif
  43   2      
  44   2              ad_key_para.cur_scan_times++;
  45   2      
  46   2              adc_scan();
  47   2       
  48   2      
  49   2              uart_receiver_timeout_add();
  50   2      
  51   2              debug_time_add();
C51 COMPILER V9.60.7.0   TIMER0                                                            02/28/2026 15:34:24 PAGE 2   

  52   2          }
  53   1      
  54   1          // 退出中断设置IP，不可删除
  55   1          __IRQnIPnPop(TMR0_IRQn);
  56   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    111    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
