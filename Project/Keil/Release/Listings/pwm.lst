C51 COMPILER V9.60.7.0   PWM                                                               02/28/2026 14:59:52 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN .\Release\Objects\pwm.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\pwm.c LARGE OPTIMIZE(9,SIZE) BROWSE INTVECTOR(0X000C) INCDIR(
                    -..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\pwm.lst) OBJECT(.\Release\Ob
                    -jects\pwm.obj)

line level    source

   1          #include "pwm.h"
   2          
   3          void pwm_init(void)
   4          {
   5   1          P3_MD0 &= ~GPIO_P30_MODE_SEL(0x03);
   6   1          P3_MD0 |= GPIO_P30_MODE_SEL(0x01); // è¾“å‡ºæ¨¡å¼
   7   1          FOUT_S30 = GPIO_FOUT_STMR0_PWMOUT; // stmr0_pwmout
   8   1      
   9   1          P2_MD1 &= ~GPIO_P27_MODE_SEL(0x03);
  10   1          P2_MD1 |= GPIO_P27_MODE_SEL(0x01); // è¾“å‡ºæ¨¡å¼
  11   1          FOUT_S27 = GPIO_FOUT_STMR1_PWMOUT; // é€‰æ‹© stmr1_pwmout
  12   1      
  13   1          // ==================================================================
  14   1          // STMR0 ç”¨ä½œ Y é»„ç¯è¾“å‡º
  15   1          STMR_CNTCLR |= STMR_0_CNT_CLR(0x01);                        // æ¸…ç©ºè®¡æ•°å€¼
  16   1          STMR0_PSC = STMR_PRESCALE_VAL(STRM0_PSC_VAL_CONFIG);        // é¢„åˆ†é¢‘ï¼ˆå¡«å…¥çš„å€¼èŒƒå›´ï¼š0~254ï
             -¼Œå¯¹åº”1~255åˆ†é¢‘ï¼‰
  17   1          STMR0_PRH = STMR_PRD_VAL_H((STMR0_PERIOD_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  18   1          STMR0_PRL = STMR_PRD_VAL_L((STMR0_PERIOD_VAL >> 0) & 0xFF);
  19   1          STMR0_CMPAH = STMR_CMPA_VAL_H(((0) >> 8) & 0xFF); // æ¯”è¾ƒå€¼
  20   1          STMR0_CMPAL = STMR_CMPA_VAL_L(((0) >> 0) & 0xFF); // æ¯”è¾ƒå€¼
  21   1          STMR_PWMVALA = STMR_0_PWMVALA(0x00);              // STMR0 PWMè¾“å‡ºå€¼
  22   1      
  23   1          STMR_CNTMD |= STMR_0_CNT_MODE(0x1); // è¿ç»­è®¡æ•°æ¨¡å¼
  24   1          STMR_LOADEN |= STMR_0_LOAD_EN(0x1); // è‡ªåŠ¨è£…è½½ä½¿èƒ½
  25   1          STMR_CNTCLR |= STMR_0_CNT_CLR(0x1); //
  26   1          STMR_CNTEN |= STMR_0_CNT_EN(0x1);   // ä½¿èƒ½
  27   1          STMR_PWMEN |= STMR_0_PWM_EN(0x1);   // PWMè¾“å‡ºä½¿èƒ½
  28   1      
  29   1          // ==================================================================
  30   1          // STMR1 ç”¨ä½œ W ç™½ç¯è¾“å‡º
  31   1          STMR_CNTCLR |= STMR_1_CNT_CLR(0x01);                        // æ¸…ç©ºè®¡æ•°å€¼
  32   1          STMR1_PSC = STMR_PRESCALE_VAL(STRM1_PSC_VAL_CONFIG);        // é¢„åˆ†é¢‘
  33   1          STMR1_PRH = STMR_PRD_VAL_H((STMR1_PERIOD_VAL >> 8) & 0xFF); // å‘¨æœŸå€¼
  34   1          STMR1_PRL = STMR_PRD_VAL_L((STMR1_PERIOD_VAL >> 0) & 0xFF);
  35   1          STMR1_CMPAH = STMR_CMPA_VAL_H(((0) >> 8) & 0xFF); // æ¯”è¾ƒå€¼ (æ¸…ç©ºæ¯”è¾ƒå€¼)
  36   1          STMR1_CMPAL = STMR_CMPA_VAL_L(((0) >> 0) & 0xFF); // æ¯”è¾ƒå€¼
  37   1          STMR_PWMVALA = STMR_1_PWMVALA(0x00);              // STMR1 PWMè¾“å‡ºå€¼
  38   1      
  39   1          STMR_CNTMD |= STMR_1_CNT_MODE(0x1); // è¿ç»­è®¡æ•°æ¨¡å¼
  40   1          STMR_LOADEN |= STMR_1_LOAD_EN(0x1); // è‡ªåŠ¨è£…è½½ä½¿èƒ½
  41   1          STMR_CNTCLR |= STMR_1_CNT_CLR(0x1); //
  42   1          STMR_CNTEN |= STMR_1_CNT_EN(0x1);   // ä½¿èƒ½
  43   1          STMR_PWMEN |= STMR_1_PWM_EN(0x1);   // PWMè¾“å‡ºä½¿èƒ½
  44   1      }
  45          
  46          // è®¾ç½®é€šé“0çš„å ç©ºæ¯”
  47          void pwm_set_channel_0_duty(u16 channel_duty)
  48          {
  49   1          STMR0_CMPAH = STMR_CMPA_VAL_H(((channel_duty) >> 8) & 0xFF); // æ¯”è¾ƒå€¼
  50   1          STMR0_CMPAL = STMR_CMPA_VAL_L(((channel_duty) >> 0) & 0xFF); // æ¯”è¾ƒå€¼
  51   1          STMR_LOADEN |= STMR_0_LOAD_EN(0x1);                          // è‡ªåŠ¨è£…è½½ä½¿èƒ½
  52   1      }
C51 COMPILER V9.60.7.0   PWM                                                               02/28/2026 14:59:52 PAGE 2   

  53          
  54          // è®¾ç½®é€šé“1çš„å ç©ºæ¯”
  55          void pwm_set_channel_1_duty(u16 channel_duty)
  56          {
  57   1          STMR1_CMPAH = STMR_CMPA_VAL_H(((channel_duty) >> 8) & 0xFF); // æ¯”è¾ƒå€¼
  58   1          STMR1_CMPAL = STMR_CMPA_VAL_L(((channel_duty) >> 0) & 0xFF); // æ¯”è¾ƒå€¼
  59   1          STMR_LOADEN |= STMR_1_LOAD_EN(0x1);                          // è‡ªåŠ¨è£…è½½ä½¿èƒ½
  60   1      }
  61          
  62          /**
  63           * @brief è·å–ç¬¬ä¸€è·¯PWMçš„è¿è¡ŒçŠ¶æ€
  64           *
  65           * @return u8 0--pwmå…³é—­ï¼Œ1--pwmå¼€å¯
  66           */
  67          u8 pwm_get_channel_0_status(void)
  68          {
  69   1          if (STMR_PWMEN & 0x01) // å¦‚æœpwm0ä½¿èƒ½
  70   1          {
  71   2              return 1;
  72   2          }
  73   1          else // å¦‚æœpwm0æœªä½¿èƒ½
  74   1          {
  75   2              return 0;
  76   2          }
  77   1      }
  78          
  79          /**
  80           * @brief è·å–ç¬¬äºŒè·¯PWMçš„è¿è¡ŒçŠ¶æ€
  81           *
  82           * @return u8 0--pwmå…³é—­ï¼Œ1--pwmå¼€å¯
  83           */
  84          u8 pwm_get_channel_1_status(void)
  85          {
  86   1          if (STMR_PWMEN & (0x01 << 1)) // å¦‚æœpwm1ä½¿èƒ½
  87   1          {
  88   2              return 1;
  89   2          }
  90   1          else // å¦‚æœ pwm æœªä½¿èƒ½
  91   1          {
  92   2              return 0;
  93   2          }
  94   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    201    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
