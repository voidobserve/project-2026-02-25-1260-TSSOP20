C51 COMPILER V9.60.7.0   LED                                                               02/28/2026 15:03:11 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LED
OBJECT MODULE PLACED IN .\Release\Objects\led.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\led.c LARGE OPTIMIZE(9,SIZE) BROWSE INTVECTOR(0X000C) INCDIR(
                    -..\..\Libraries\Include;..\..\User) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Release\Listings\led.lst) OBJECT(.\Release\Ob
                    -jects\led.obj)

line level    source

   1          #include "led.h"
   2          #include "pwm.h"
   3          #include "user_test.h"
   4          
   5          led_ctl_t led_ctl;
   6          
   7          void led_init(void)
   8          {
   9   1          // 100% 电量指示灯
  10   1          P1_MD0 &= ~GPIO_P13_MODE_SEL(0x03);
  11   1          P1_MD0 |= GPIO_P13_MODE_SEL(0x01); // 输出
  12   1          FOUT_S13 = GPIO_FOUT_AF_FUNC;
  13   1          P13 = 0;
  14   1      
  15   1          // 75% 电量指示灯
  16   1          P0_MD1 &= ~GPIO_P06_MODE_SEL(0x03);
  17   1          P0_MD1 |= GPIO_P06_MODE_SEL(0x01);
  18   1          FOUT_S06 = GPIO_FOUT_AF_FUNC;
  19   1          P06 = 0; // 不点亮指示灯
  20   1      
  21   1          // 50% 电量指示灯
  22   1          P0_MD1 &= ~GPIO_P05_MODE_SEL(0x03);
  23   1          P0_MD1 |= GPIO_P05_MODE_SEL(0x01);
  24   1          FOUT_S05 = GPIO_FOUT_AF_FUNC;
  25   1          P05 = 0; // 不点亮指示灯
  26   1      
  27   1          // 25% 电量指示灯
  28   1          P0_MD0 &= ~GPIO_P00_MODE_SEL(0x03);
  29   1          P0_MD0 |= GPIO_P00_MODE_SEL(0x01);
  30   1          FOUT_S00 = GPIO_FOUT_AF_FUNC;
  31   1          P00 = 0; // 不点亮指示灯
  32   1      }
  33          
  34          void led_ctl_init(void)
  35          {
  36   1          led_ctl.cnt = 0;
  37   1          led_ctl.cur_period_val = 0;
  38   1          led_ctl.dest_period_val = STRM0_PERIOD_30_PERCENT_VAL;
  39   1      }
  40           
  41          void led_status_switch(void)
  42          {
  43   1          switch (led_ctl.status)
  44   1          {
  45   2              case LED_STATUS_OFF:
  46   2                  led_ctl.status = LED_STATUS_YELLOW;
  47   2                  LED_YELLOW_ON();
  48   2              break;
  49   2              case LED_STATUS_YELLOW:
  50   2                  led_ctl.status = LED_STATUS_WHITE;
  51   2                  LED_YELLOW_OFF();
  52   2                  LED_WHITE_ON();
  53   2              break;
C51 COMPILER V9.60.7.0   LED                                                               02/28/2026 15:03:11 PAGE 2   

  54   2              case LED_STATUS_WHITE:
  55   2                  led_ctl.status = LED_STATUS_WHITE_YELLOW;
  56   2                  LED_YELLOW_ON();
  57   2              break;
  58   2              case LED_STATUS_WHITE_YELLOW:
  59   2                  led_ctl.status = LED_STATUS_RED_BLUE_FLASH;
  60   2                  LED_YELLOW_OFF();
  61   2                  LED_WHITE_OFF();
  62   2              break;
  63   2          }
  64   1      }
  65          
  66          // 根据led状态，执行对应的操作
  67          void led_status_handle(void)
  68          {
  69   1      
  70   1      }
  71          
  72          // 红灯、蓝灯闪烁的动画效果，由定时器调用
  73          void led_red_blue_flash_isr(void)
  74          {
  75   1      
  76   1      }
  77          
  78          
  79          void led_slow_start_isr(void)
  80          {
  81   1          if (led_ctl.cur_period_val >= led_ctl.dest_period_val)
  82   1          { 
  83   2              return;
  84   2          }
  85   1      
  86   1          led_ctl.cnt++;
  87   1      
  88   1      
  89   1          // USER_TO_DO 
  90   1          if (led_ctl.cnt < YELLOW_SLOW_START_ADJUST_TIME)
  91   1          {
  92   2              return;
  93   2          }
  94   1      
  95   1          led_ctl.cnt = 0;
  96   1          led_ctl.cur_period_val++;
  97   1          pwm_set_channel_0_duty(led_ctl.cur_period_val);
  98   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    239    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
